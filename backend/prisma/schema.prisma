generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  role      Role     @default(USER)
  firstName String?
  lastName  String?
  registrationStatus RegistrationStatus @default(APPROVED)
  registrationForm Json?
  approvedAt DateTime?
  createdAt DateTime @default(now())
  offers    Offer[]
  favorites Favorite[]
}

enum Role {
  USER
  ADMIN
}

enum RegistrationStatus {
  PENDING
  APPROVED
}

model Car {
  id           Int        @id @default(autoincrement())
  displayId    String     @unique
  make         String
  model        String
  year         Int
  mileage      Int
  price        Int?
  location     String?
  description  String?
  descriptionDetails Json?
  auctionStart DateTime?
  auctionEnd   DateTime?
  provider     String?
  vin          String?
  registrationNumber   String?
  firstRegistrationDate DateTime?
  fuelType     String?
  transmission String?
  bodyType     String?
  driveType    String?
  power        String?
  seats        Int?
  doors        Int?
  adminDismissed Boolean @default(false)
  source       CarSource @default(API)
  importedAt   DateTime?
  images       CarImage[]
  offers       Offer[]
  favorites    Favorite[]
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model CarImage {
  id    Int    @id @default(autoincrement())
  url   String
  order Int    @default(0)
  car   Car    @relation(fields: [carId], references: [id])
  carId Int
}

model Offer {
  id        Int      @id @default(autoincrement())
  amount    Int
  message   String?
  isWinner  Boolean  @default(false)
  winnerStatus WinnerStatus?
  car       Car     @relation(fields: [carId], references: [id])
  carId     Int
  user      User    @relation(fields: [userId], references: [id])
  userId    Int
  createdAt DateTime @default(now())
}

model Favorite {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  car       Car      @relation(fields: [carId], references: [id])
  carId     Int
  createdAt DateTime @default(now())

  @@unique([userId, carId])
}

enum CarSource {
  API
  IMPORTED
  SAMPLE
}

enum WinnerStatus {
  WON
  AWARDED
}

model ImportJob {
  id          Int      @id @default(autoincrement())
  filename    String   @unique
  checksum    String?
  total       Int      @default(0)
  added       Int      @default(0)
  updated     Int      @default(0)
  skipped     Int      @default(0)
  errors      Json?
  processedAt DateTime @default(now())
}
